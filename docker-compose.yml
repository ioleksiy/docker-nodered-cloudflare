services:
  nodered:
    image: nodered/node-red:latest
    container_name: ${STACK_NAME:-nodered}_nodered
    restart: unless-stopped
    environment:
      - TZ=UTC
    volumes:
      - nodered_data:/data
    networks:
      - internal_network
    # No ports exposed to host - access only through Cloudflare Tunnel

  cloudflared:
    image: cloudflare/cloudflared:latest
    container_name: ${STACK_NAME:-nodered}_cloudflared
    restart: unless-stopped
    command: tunnel run
    environment:
      - TUNNEL_TOKEN=${TUNNEL_TOKEN}
    networks:
      - internal_network
    depends_on:
      - nodered

volumes:
  nodered_data:
    driver: local

networks:
  internal_network:
    driver: bridge
    internal: false  # Set to true for complete isolation, false to allow outbound internet access
