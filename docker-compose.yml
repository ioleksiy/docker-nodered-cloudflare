services:
  nodered:
    image: nodered/node-red:latest
    restart: unless-stopped
    environment:
      - TZ=UTC
    volumes:
      - nodered_data:/data
    networks:
      - internal_network
    deploy:
      replicas: 1
      restart_policy:
        condition: unless-stopped
    # No ports exposed to host - access only through Cloudflare Tunnel

  cloudflared:
    image: cloudflare/cloudflared:latest
    restart: unless-stopped
    command: tunnel run
    environment:
      - TUNNEL_TOKEN=${TUNNEL_TOKEN}
    networks:
      - internal_network
    deploy:
      replicas: 1
      restart_policy:
        condition: unless-stopped

volumes:
  nodered_data:
    driver: local

networks:
  internal_network:
    driver: overlay
    attachable: true
