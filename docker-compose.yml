services:
  nodered:
    image: nodered/node-red:latest
    environment:
      - TZ=UTC
      - NODE_RED_ENABLE_SAFE_MODE=false
      - NODE_RED_CREDENTIAL_SECRET=${NODE_RED_CREDENTIAL_SECRET:-my-secret-key}
    volumes:
      - nodered_data:/data
    networks:
      - internal_network
    deploy:
      replicas: 1
      restart_policy:
        condition: any
    # No ports exposed to host - access only through Cloudflare Tunnel

  cloudflared:
    image: cloudflare/cloudflared:latest
    command: tunnel run
    environment:
      - TUNNEL_TOKEN=${TUNNEL_TOKEN}
    networks:
      - internal_network
    deploy:
      replicas: 1
      restart_policy:
        condition: any

volumes:
  nodered_data:
    driver: local

networks:
  internal_network:
    driver: overlay
    attachable: true
